---
name: annotations
description: 科研代码注释规范。面向灵巧抓取项目的快速迭代开发，强制执行 Google Docstring + 注释即契约：记录研究动机、物理约束、坐标系约定、数学推导。优先解释"为什么"而非"是什么"。
---

# Annotations（科研代码注释规范）

## 定位与原则

**面向对象**：首席研究员及其团队（而非纯工程师）  
**核心目标**：让代码成为可复现的研究记录，而非仅仅是可运行的程序

### 四大原则

1. **研究动机优先**
   - 注释首先回答：为什么这样设计？解决什么科研问题？
   - 其次才是：怎么实现的？
   - 示例：❌ "计算四元数乘法" → ✅ "将抓取姿态从物体坐标系转换到世界坐标系，用于与 baseline 方法对齐"

2. **物理约束显式化**（灵巧抓取特定）
   - **坐标系**：world/object/robot/camera，必须明确声明
   - **四元数约定**：wxyz/xyzw，必须标注
   - **单位**：米/毫米、弧度/度、牛顿/克力
   - **物理限制**：关节角度范围、接触力阈值、稳定性条件

3. **数学推导可追溯**
   - 复杂算法必须在 Notes 中提供：参考论文/公式编号、伪代码或 LaTeX 公式、与论文符号的映射关系

4. **契约式注释**（继承 Google Docstring）
   - 前置条件：输入张量形状、归一化状态、必需键
   - 后置条件：输出保证、不变量维持
   - 失败模式：何时抛异常、何时返回 NaN

## 必须记录的内容

### 函数/方法
- 研究动机（解决什么问题）
- Args/Returns/Raises（Google 风格）
- Notes（数学推导、论文引用、与论文差异）

### 类/组件
- 研究目标
- Attributes（状态、单位、生命周期）
- 公共方法的副作用和不变量

### 配置/超参数
- 默认值理由（消融实验结果）
- 单位、有效范围
- 跨字段约束

### 实现注释
- 设计决策（为什么这样做）
- 性能优化（缓存、预计算）
- 临时 workaround（TODO 标记）

## Review 检查清单

- [ ] 每个公共函数有完整 docstring（Args/Returns/Notes）
- [ ] 坐标系/单位/四元数约定已明确标注
- [ ] 复杂算法有论文引用或数学推导
- [ ] 魔法数字有注释解释来源
- [ ] 临时 hack 有 TODO 标记
- [ ] 与论文符号的映射关系已说明

## 反模式

❌ **仅重述代码**：应该解释为什么  
❌ **缺少物理单位**：应标注单位和坐标系  
❌ **隐含坐标系**：应说明从哪个 frame 到哪个 frame  
❌ **数学公式无出处**：应引用论文公式编号  
❌ **过时注释**：重构后忘记更新 docstring
