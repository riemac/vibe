---
name: annotations
description: 快速迭代项目（"vibe coding"）的注释和文档协议。强制执行 Google Docstring 风格加注释即契约：与签名/类型一致、显式前置/后置条件、单位/坐标系/约定，以及丰富的实现注释。对复杂算法使用 Notes 配合 ASCII + 伪代码。
---

# Annotations（Google Docstring + 注释即契约）
## 核心原则

1. **Google Docstring 风格（主要）**
   - 使用 Google 风格章节：`Args`、`Returns`、`Raises`、`Attributes`、`Notes`、`Examples`
   - Docstrings 必须描述*语义和契约*，而非重述名称

2. **注释即契约**
   记录任何可能静默失败的内容：
   - **前置/后置条件**：范围、形状、dtype/device、必需键、顺序
   - **单位和约定**：单位、角度约定、坐标系、轴顺序、四元数约定、归一化
   - **确定性与随机性**：种子、采样行为、随机分支
   - **失败模式**：何时抛出异常、未定义行为、NaN/溢出风险

3. **签名/类型信息和文档必须一致**
   - 签名 + 类型提示是真理来源
   - 文档不得矛盾；对类型无法表达的约束使用散文

4. **实现注释必需**
   - 在代码附近提供密集的局部解释
   - 优化为"未来的你"能够安全修改而无需重新推导意图

## 必须记录的内容

### 函数 / 方法
- 单行摘要（祈使语气）
- 每个参数的 `Args`（含义 + 约束）
- 每个返回值的 `Returns`（含义 + 形状/单位/约定）
- 有意或常见失败的 `Raises`
- 如果算法非平凡、涉及数学/几何、有微妙不变量或有性能/稳定性考虑，使用 `Notes`

### 类 / 组件
- 单行摘要 + 系统中的角色
- `Attributes` 记录状态、单位/约定、生命周期（创建/重置/更新）
- 有副作用和不变量的公共方法

### 配置 / Schema / CLI
- 每个字段/标志的含义、默认值理由（如果不明显）、单位、有效范围
- 跨字段约束（如 `min <= max`、互斥标志）

### 实现注释（代码内部）
当代码包含以下内容时必需：
- 非显而易见的变换或约定
- 编码设计选择的分支逻辑
- "魔法数字"（阈值、缩放、epsilon）
- 性能技巧（向量化、缓存、预分配）
- 可能忘记移除的"临时"逻辑

指南：注释回答**为什么** + **什么不变量**（而非叙述显而易见的操作）

## 模板和示例

查看资源文件以获取详细模板和 Python/IsaacLab 示例：
- [Templates](./resources/templates.md) - 函数、类、配置模板
- [Examples](./resources/examples.md) - Python + IsaacLab 代码示例

## Review 检查清单

- Docstrings/注释与签名 + 类型提示匹配
- 非显而易见输入的约束已记录（范围/形状/单位/坐标系/约定）
- 发生变换的地方已声明坐标系/单位/约定
- 魔法常量已证明合理或替换为带理由的命名常量
- 复杂算法存在 Notes 并包含伪代码
- 实现注释解释*为什么*和不变量，而非平凡步骤
- 重构后文档已更新（无漂移）

## 反模式

❌ Docstrings 仅重述名称而无语义  
❌ 可能误解的地方缺少单位/坐标系/约定  
❌ 注释叙述显而易见的操作而非意图  
❌ 静默假设（度 vs 弧度、轴顺序、四元数约定）未记录  
❌ 签名变更后 docstrings 漂移

